import { useState } from 'react';
import throttle from 'lodash.throttle';
import { AnimatePresence, motion } from 'framer-motion';
import BottomTabs from './BottomTabs';
import SustainabilityPanel from './panels/SustainabilityPanel';
import InstallStepsPanel from './panels/InstallStepsPanel';
import CostComparePanel from './panels/CostComparePanel';
import ProcessSliderPanel from './panels/ProcessSliderPanel';

const PANELS = [
    { key: 'feature_0', title: 'Sustainability', icon: <SustainIcon /> },
    { key: 'feature_1', title: 'Streamline Installation', icon: <InstallIcon /> },
    { key: 'feature_2', title: 'Cost Saving', icon: <CostIcon /> },
    { key: 'feature_3', title: 'Design Collaboration', icon: <DesignIcon /> }
] as const;

export default function FeatureSection() {
    const [active, setActive] = useState<string>('feature_0');

    /* store value, throttled so we don’t spam LS while user cycles */
    const persist = throttle((k: string) => localStorage.setItem('urblo:feat', k), 500);

    const change = (k: typeof active) => {
        setActive(k);
        persist(k);
    };

    const renderPanel = () => {
        switch (active) {
            case 'feature_0': return <SustainabilityPanel />;
            case 'feature_1': return <InstallStepsPanel />;
            case 'feature_2': return <CostComparePanel />;
            case 'feature_3': return <ProcessSliderPanel />;
            default:          return null;
        }
    };

    return (
        <section className="relative w-full h-[520px] overflow-hidden">
            <div className="relative h-[420px] md:h-[480px] w-full overflow-hidden">
                {/* Panel container */}
                <AnimatePresence mode="wait">
                    <motion.div
                        key={active}
                        className="h-full w-full"
                        initial={{ opacity: 0, y: 20 }}
                        animate={{ opacity: 1, y: 0 }}
                        exit={{ opacity: 0, y: -20 }}
                        transition={{ duration: 0.4, ease: 'easeInOut' }}
                    >
                        {renderPanel()}
                    </motion.div>
                </AnimatePresence>
            </div>

            {/* sticky footer for ≥ md */}
            <div className="pointer-events-none md:sticky md:bottom-0 md:z-10">
                <BottomTabs
                    items={PANELS}
                    activeKey={active}
                    onChange={change}
                />
            </div>
        </section>
    );
}

/* ——示例 SVG 先留空壳—— */
function SustainIcon() { return <svg xmlns="http://www.w3.org/2000/svg" width="46" height="47" viewBox="0 0 46 47" fill="none"><g clip-path="url(#clip0_909_1650)"><path d="M22.9896 38.4444C23.1431 38.4444 23.306 38.4413 23.5008 38.435L23.5096 38.4349C27.5554 38.3019 31.338 36.6255 34.1605 33.7146C36.9895 30.797 38.5476 26.9515 38.5476 22.8865C38.5476 20.3283 37.913 17.7913 36.7121 15.5499C36.4503 15.0614 35.9244 14.7682 35.3714 14.8041C35.0993 14.8217 34.8288 14.8469 34.5596 14.8783C31.925 11.0745 27.6318 8.81641 22.9896 8.81641C21.2446 8.81578 19.5148 9.13994 17.8884 9.77234C17.8552 9.78269 17.8228 9.79561 17.7915 9.81098C17.7895 9.81197 17.7877 9.81331 17.7856 9.8143C14.7254 11.0322 12.1892 13.2845 10.6182 16.1794C10.535 16.3362 10.5171 16.5196 10.5683 16.6896C10.6196 16.8596 10.7358 17.0025 10.8918 17.0873C11.0479 17.172 11.231 17.1918 11.4015 17.1422C11.572 17.0927 11.7161 16.9778 11.8024 16.8227C12.2271 16.0411 12.7324 15.306 13.31 14.6295H14.5576C14.7911 14.6292 15.0188 14.7026 15.2082 14.8391C15.3977 14.9757 15.5393 15.1684 15.6129 15.39C15.7987 15.949 16.1559 16.4353 16.6337 16.7797C17.1116 17.1241 17.6858 17.3092 18.2749 17.3086H19.0714C19.8755 17.3086 20.5297 17.9629 20.5297 18.767V21.15C20.5292 21.5999 20.4244 22.0436 20.2237 22.4462L19.802 23.2896C19.6307 23.6337 19.3923 23.9401 19.1009 24.1908C18.8095 24.4414 18.4709 24.6313 18.1051 24.7493C17.6557 24.4536 17.1911 24.1817 16.7133 23.9345C14.7337 22.9135 12.5257 22.3309 10.2855 22.2296C10.329 21.3751 10.4562 20.529 10.6678 19.7064C10.6901 19.6206 10.6952 19.5313 10.6829 19.4435C10.6706 19.3558 10.6411 19.2713 10.5962 19.195C10.5512 19.1186 10.4916 19.0519 10.4208 18.9986C10.3499 18.9453 10.2693 18.9065 10.1835 18.8845C10.0977 18.8624 10.0083 18.8575 9.92062 18.87C9.83289 18.8824 9.74849 18.9121 9.67224 18.9573C9.596 19.0024 9.52941 19.0622 9.47629 19.1331C9.42317 19.204 9.38456 19.2848 9.36268 19.3706C9.12306 20.3021 8.98147 21.2607 8.93664 22.2281C8.89118 22.23 8.84562 22.2304 8.80016 22.2328C8.61371 22.2417 8.43088 22.2876 8.26232 22.3678C8.09376 22.448 7.94281 22.5609 7.81826 22.7C7.6927 22.8386 7.59591 23.0007 7.53352 23.177C7.47114 23.3533 7.44439 23.5402 7.45484 23.727C7.89445 31.9797 14.7182 38.4444 22.9896 38.4444ZM35.4579 16.149L35.462 16.1489C35.4874 16.1489 35.512 16.1636 35.5241 16.1864C36.6204 18.2328 37.1999 20.5496 37.1999 22.8865C37.1999 29.8029 32.3446 35.5337 25.7855 36.8234C26.4785 36.1924 27.2958 35.3532 28.1371 34.2809C30.1428 31.7249 32.6727 27.2977 33.3347 20.7213C33.3526 20.5435 33.2991 20.3659 33.186 20.2275C33.073 20.0891 32.9096 20.0013 32.7318 19.9834C32.362 19.9469 32.0311 20.2161 31.9939 20.5865C31.3677 26.8075 28.9971 30.9858 27.1189 33.3955C25.7551 35.145 24.4463 36.2424 23.7229 36.7812C22.709 34.7928 22.1749 32.5776 22.1749 30.3286C22.175 22.8569 28.0096 16.6285 35.4579 16.149ZM26.5051 18.3108C26.5455 18.1936 26.5935 18.0791 26.6487 17.9681L27.0703 17.1247C27.5645 16.1364 28.558 15.5224 29.663 15.5224H31.5976C29.7459 16.1198 28.02 17.0626 26.5051 18.3108ZM25.7043 10.4551L24.7454 11.8934C24.6439 12.0459 24.5063 12.1709 24.3449 12.2573C24.1834 12.3438 24.003 12.3889 23.8199 12.3887H21.6251C20.5231 12.3887 19.5324 11.7778 19.0368 10.7941C20.3128 10.3767 21.647 10.164 22.9895 10.164C23.9022 10.164 24.8123 10.2616 25.7043 10.4551ZM21.0073 23.8923L21.429 23.049C21.723 22.4591 21.8765 21.8092 21.8773 21.1501V18.7671C21.8773 17.2199 20.6185 15.9611 19.0713 15.9611H18.2748C17.9687 15.9613 17.6702 15.8652 17.4218 15.6862C17.1735 15.5071 16.9878 15.2544 16.8913 14.9639C16.7329 14.4879 16.4325 14.0718 16.0305 13.7717C15.6285 13.4716 15.1442 13.3018 14.6428 13.2852C15.5829 12.4681 16.6379 11.7935 17.774 11.2829L17.8272 11.3892C18.5511 12.837 20.0064 13.7364 21.6251 13.7364H23.8199C24.2249 13.7369 24.6238 13.6371 24.9809 13.4459C25.3381 13.2548 25.6423 12.9783 25.8666 12.641L27.0716 10.8337C29.0511 11.5022 30.8344 12.65 32.2627 14.175H29.6629C28.0441 14.175 26.5889 15.0744 25.8649 16.5221L25.4433 17.3654C25.1492 17.9553 24.9958 18.6053 24.995 19.2644V19.7325C22.9999 21.8758 21.6706 24.4994 21.1181 27.3247C20.5736 26.7248 19.9836 26.1677 19.3535 25.6585C20.065 25.2433 20.6397 24.6295 21.0073 23.8923ZM8.8193 23.6021C8.82543 23.5951 8.83292 23.5894 8.84132 23.5853C8.84973 23.5813 8.85886 23.579 8.86818 23.5786C9.10896 23.5665 9.35297 23.5603 9.59339 23.5603C13.9964 23.5603 18.1934 25.6391 20.8736 29.1319C20.8431 29.53 20.8276 29.9292 20.8274 30.3285C20.828 32.1014 21.131 33.8612 21.7234 35.5323C18.9604 33.9217 14.8663 30.9995 13.1901 27.0864C13.119 26.9233 12.9862 26.795 12.8208 26.7295C12.6554 26.6639 12.4708 26.6664 12.3072 26.7365C12.1436 26.8065 12.0144 26.9384 11.9478 27.1034C11.8811 27.2684 11.8824 27.453 11.9513 27.617C12.9229 29.885 14.6955 32.0633 17.2201 34.0911C18.7656 35.3324 20.3438 36.3169 21.6316 37.0322C14.7007 36.3746 9.17769 30.7357 8.80052 23.6552C8.79986 23.6455 8.80119 23.6358 8.80442 23.6267C8.80765 23.6176 8.81271 23.6092 8.8193 23.6021Z" fill="rgba(0,0,0,1)"></path><path d="M40.0444 8.19072L39.5945 6.24111C39.5525 6.05921 39.4626 5.89186 39.334 5.75644C39.2055 5.62101 39.0431 5.52246 38.8636 5.47099C38.6842 5.41952 38.4942 5.41703 38.3135 5.46375C38.1327 5.51048 37.9678 5.60474 37.8357 5.73673L37.6629 5.9095C35.654 4.24101 33.4039 2.94106 30.9708 2.04379C28.4451 1.1122 25.7817 0.63675 23.0545 0.630461L23.0005 0.630371C18.2928 0.630371 13.7593 2.04882 9.88748 4.73389C9.81453 4.78422 9.75221 4.84844 9.70411 4.92289C9.65602 4.99733 9.62308 5.08053 9.60718 5.16773C9.59129 5.25492 9.59275 5.34439 9.61149 5.43102C9.63023 5.51765 9.66587 5.59973 9.71638 5.67256C9.76688 5.74539 9.83126 5.80754 9.90583 5.85545C9.98039 5.90337 10.0637 5.9361 10.1509 5.95177C10.2381 5.96745 10.3276 5.96576 10.4142 5.9468C10.5008 5.92785 10.5828 5.892 10.6555 5.84131C14.3008 3.31329 18.5683 1.97803 23.0005 1.97803H23.0514C28.1675 1.98989 33.1216 3.81372 37.001 7.1135C37.4084 7.4602 38.0201 7.44152 38.4037 7.07423L39.4414 11.5707C39.4437 11.5812 39.4501 11.6087 39.4225 11.6363C39.3949 11.6639 39.3676 11.6575 39.357 11.6551L34.8412 10.613C34.9726 10.4228 35.0373 10.1946 35.0253 9.96379C35.0175 9.81698 34.979 9.67344 34.9122 9.54245C34.8454 9.41147 34.7519 9.29594 34.6377 9.20335C31.3186 6.51612 27.2944 5.09561 23 5.09561C18.0492 5.09561 13.3946 7.02356 9.89395 10.5243C6.39319 14.0251 4.46523 18.6795 4.46523 23.6304C4.46523 27.5787 5.71227 31.3816 8.0084 34.5318L6.93863 34.2849C6.70433 34.2301 6.45988 34.2361 6.22856 34.3024C5.99724 34.3688 5.78675 34.4932 5.61712 34.6639C5.44639 34.8335 5.32191 35.044 5.25555 35.2754C5.18918 35.5067 5.18313 35.7512 5.23798 35.9855L5.24831 36.0304C2.71768 32.4172 1.34766 28.1071 1.34766 23.6304C1.34766 17.7056 3.69716 12.1725 7.96348 8.05057C8.06368 7.95372 8.16485 7.85788 8.26697 7.76307C8.39376 7.64044 8.46742 7.47299 8.47215 7.29667C8.47688 7.12034 8.4123 6.94918 8.29227 6.81993C8.17224 6.69068 8.00632 6.61364 7.83013 6.60533C7.65394 6.59703 7.48151 6.65812 7.34985 6.7755C7.24127 6.87638 7.13369 6.97833 7.02713 7.08133C2.49559 11.4596 0 17.3368 0 23.6304C0 29.359 2.1116 34.8309 5.94784 39.0616L6.39795 41.0122C6.43997 41.1941 6.5299 41.3614 6.6584 41.4968C6.7869 41.6322 6.94929 41.7307 7.12872 41.7822C7.30815 41.8337 7.49809 41.8362 7.67883 41.7895C7.85956 41.7428 8.02451 41.6486 8.15656 41.5166L8.32878 41.3444C10.3381 43.0147 12.5887 44.3161 15.0226 45.2146C17.5492 46.1474 20.2137 46.6236 22.9419 46.6304H22.999C25.9514 46.6304 28.8404 46.0705 31.5859 44.9662C34.3513 43.8538 36.8367 42.2433 38.9729 40.1792C43.5045 35.801 46 29.9237 46 23.6304C46 17.8978 43.8856 12.4228 40.0444 8.19072ZM5.81289 23.6304C5.81289 19.0395 7.6006 14.7234 10.8468 11.4773C14.0931 8.23106 18.4092 6.44326 23 6.44326C26.8704 6.44326 30.5034 7.68688 33.5288 10.0437L33.5229 10.0496C33.3909 10.1816 33.2967 10.3466 33.2499 10.5273C33.2032 10.7081 33.2057 10.898 33.2571 11.0775C33.3086 11.2569 33.4072 11.4193 33.5427 11.5478C33.6781 11.6763 33.8454 11.7662 34.0273 11.8083L35.8624 12.2317C38.6522 15.3723 40.1871 19.4113 40.1871 23.6304C40.1871 28.2213 38.3994 32.5373 35.1531 35.7834C31.9069 39.0297 27.5909 40.8175 23 40.8175C19.1258 40.8175 15.4898 39.5714 12.4629 37.2105L12.4697 37.2037C12.7384 36.935 12.8403 36.5411 12.7355 36.1758C12.6308 35.8105 12.3356 35.5304 11.9653 35.445L10.1311 35.0217C7.34545 31.8824 5.81289 27.8459 5.81289 23.6304ZM38.0367 39.2101C33.9822 43.1275 28.6442 45.2827 22.9996 45.2827L22.9454 45.2826C17.8269 45.27 12.8712 43.4439 8.99129 40.1405C8.58394 39.7938 7.97264 39.8121 7.58883 40.179L6.55114 35.6825C6.54785 35.6709 6.54787 35.6586 6.55121 35.647C6.55454 35.6354 6.56105 35.625 6.57 35.6169C6.57812 35.608 6.58855 35.6015 6.60013 35.5982C6.61172 35.5949 6.62399 35.5948 6.63559 35.5981L11.1511 36.6401C11.0195 36.8304 10.9545 37.0589 10.9664 37.2899C10.9742 37.4367 11.0127 37.5802 11.0794 37.7111C11.1461 37.8421 11.2395 37.9576 11.3536 38.0502C14.6742 40.7422 18.7014 42.165 23 42.165C27.9508 42.165 32.6053 40.2371 36.106 36.7363C39.6068 33.2357 41.5348 28.5812 41.5348 23.6304C41.5348 19.6789 40.2858 15.8736 37.9864 12.7219L39.054 12.9683C39.5335 13.079 40.0275 12.9373 40.3755 12.5893C40.7235 12.2413 40.8652 11.7473 40.7546 11.2677L40.7432 11.2181C43.2794 14.8339 44.6523 19.1484 44.6523 23.6304C44.6523 29.555 42.3029 35.088 38.0367 39.2101Z" fill="rgba(0,0,0,1)"></path></g><defs><clipPath id="clip0_909_1650"><rect width="46" height="46" fill="white" transform="translate(0 0.630371)"></rect></clipPath></defs></svg> }
function InstallIcon() { return <svg width="24" height="24" /> }
function CostIcon()    { return <svg width="24" height="24" /> }
function DesignIcon()  { return <svg width="24" height="24" /> }
